:root{
  --bg:#0b1220;
  --card:#0f172a;
  --ink:#e5e7eb;
  --muted:#9ca3af;
  --accent:#22c55e;
  --danger:#ef4444;
  --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  --radius:14px;

  /* золото + стекло — ЕЩЁ прозрачнее */
  --gold:#d4af37;
  --gold-200:#e6c75a;
  --gold-300:#f3dfa2;

  /* уменьшаем альфу (последняя цифра) — больше прозрачности */
  --glass:        rgba(16,12,0,0.18);  /* шапка/табы */
  --glass-strong: rgba(16,12,0,0.24);  /* сайдбар */
  --card-glass:   rgba(15,23,42,0.18); /* карточки */
  --field-glass:  rgba(11,18,32,0.20); /* поля/списки */
  --stroke:       rgba(212,175,55,0.32);
  --stroke-strong:rgba(212,175,55,0.48);
  --shadow: 0 8px 28px rgba(0,0,0,.35);
}

*{box-sizing:border-box}
html,body{height:100%}
html{
  scroll-behavior:smooth;
  -webkit-text-size-adjust:100%;
}
body{
  margin:0;
  display:flex;
  flex-direction:column;
  /* svh: учитывает динамические панели браузера на мобилках */
  min-height:100svh;
  background:linear-gradient(180deg,#0b1220,#0b1220 40%,#0d1528);
  color:var(--ink);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol";
  line-height:1.4;
  overflow-x:hidden;
}

/* === Шапка (липкая) === */
.app-header{
  position:sticky; top:0; z-index:10;
  background:var(--glass);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-bottom:1px solid var(--stroke);
  padding:10px 14px;
  display:flex;align-items:center;gap:12px;
  box-shadow: var(--shadow);
}

/* === Футер (в самом низу; без прилипания) === */
.app-footer{
  margin-top:auto;
  background:var(--glass);
  border-top:1px solid var(--stroke);
  padding:8px 12px;
  padding-bottom: calc(8px + env(safe-area-inset-bottom, 0px)); /* не «висит» на iOS */
  text-align:center;
}

.brand{display:flex;align-items:center;gap:10px}
.brand .logo{font-size:24px}
.brand h1{font-size:18px;margin:0}

/* контейнер и карточки */
.container{
  max-width:980px;
  margin:20px auto 24px;
  padding:0 12px;
  display:grid;
  gap:16px
}
.card{
  background:var(--card-glass);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border:1px solid var(--stroke);
  border-radius:var(--radius);
  padding:14px;
  box-shadow: 0 6px 24px rgba(0,0,0,.28);
}
.card.subtle{background:rgba(15,23,42,0.15)}

/* утилиты */
.row{display:flex; align-items:center}
.wrap{flex-wrap:wrap}
.gap{gap:8px}
.mt{margin-top:12px}
.spacer{flex:1}
.grow{flex:1}

/* === Табы === */
.tabs{
  display:inline-flex;
  background:var(--glass);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border:1px solid var(--stroke);
  border-radius:999px;
  padding:4px;
  box-shadow: var(--shadow);
}
.tab{
  border:none; background:transparent; color:var(--gold-300);
  padding:8px 12px; border-radius:999px; cursor:pointer;
  transition:background .15s, color .15s, border-color .15s;
}
.tab:hover{
  background: rgba(0,0,0,0.12);
  color: var(--gold);
}
.tab.active{
  background: rgba(212,175,55,0.10);
  color:#fff;
  box-shadow: inset 0 0 0 1px var(--stroke);
}

/* режимы вкладок */
.mode{display:none;margin-top:8px}
.mode.visible{display:block}

/* === Поля/селекты — стекло, без синевы === */
.field{display:flex;flex-direction:column;gap:6px; min-width:140px; flex:1}
.field input,
.field select,
textarea{
  width:100%;
  background:var(--field-glass);
  color:var(--ink);
  border:1px solid rgba(255,255,255,.12);
  border-radius:10px; padding:10px 12px;
  font-size:16px;
  outline:none; box-shadow:none;
  transition:border-color .15s, box-shadow .15s, background .15s;
  -webkit-appearance:none; appearance:none;
}
.field input::placeholder,
textarea::placeholder{ color:rgba(255,240,200,.55); }
.field input:focus,
.field select:focus,
textarea:focus{
  border-color: var(--stroke-strong);
  box-shadow: 0 0 0 2px rgba(212,175,55,0.18);
  background: rgba(11,18,32,0.30);
}
select option{ background:#0b1220; color:var(--ink); }
input[type="checkbox"]{ accent-color: var(--gold); }

/* кнопки */
.btn{
  background: rgba(25,35,59,0.38);
  color:var(--ink);
  border:1px solid rgba(255,255,255,.14);
  padding:8px 12px; border-radius:10px; cursor:pointer;
  transition:filter .15s, transform .02s, color .15s, border-color .15s, background .15s;
}
.btn:hover{filter:brightness(1.12); border-color:var(--stroke); color:var(--gold-200)}
.btn:active{transform:translateY(1px)}
.btn.primary{
  background: linear-gradient(180deg, rgba(212,175,55,0.78), rgba(180,140,30,0.82));
  border:1px solid var(--gold);
  color:#1a1100;
  text-shadow: 0 1px 0 rgba(255,255,255,0.35);
}
.btn.primary:hover{filter:brightness(1.06)}
.btn.icon{
  font-size:18px; padding:6px 10px;
  border-color: var(--stroke);
  background: rgba(0,0,0,0.14);
  color: var(--gold-300);
}
.btn.icon:hover{ background: rgba(0,0,0,0.22); color: var(--gold); }
.btn.danger{background:#2a1518; border-color:#402325; color:#ffb5b5}
.btn.file{position:relative; overflow:hidden}
.btn.file input{position:absolute; inset:0; opacity:0; cursor:pointer}

/* сетка */
.grid{display:grid; gap:8px}
.cols-2{grid-template-columns: 1fr 1fr}
@media (max-width:740px){ .cols-2{grid-template-columns: 1fr} }

/* мелочи */
.mono{font-family:var(--mono); font-size:13px}
.editor{min-height:240px}
.scroll{
  max-height:260px; overflow:auto;
  padding:10px;
  background:var(--field-glass);
  border:1px solid rgba(255,255,255,.10);
  border-radius:8px
}
ul{margin:6px 0 0 16px}
h2,h3{margin:.2em 0 .4em}
h3{font-size:16px; color:var(--gold-200)}
small,.hint{color:rgba(255, 240, 200, 0.82)}

/* Треки */
.tracks{list-style:none; margin:0; padding:0; max-height:260px}
.tracks li{
  display:flex; align-items:center; justify-content:space-between;
  gap:8px; padding:8px 10px; border:1px solid rgba(255,255,255,.10);
  background:var(--field-glass); border-radius:10px; margin-bottom:6px; cursor:pointer;
  max-width:100%;
}
.tracks li.active{outline:2px solid #22c55e}
.tracks .title{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:70%; }
.tracks .len{color:var(--muted); font-variant-numeric: tabular-nums}

/* === Сайдбар === */
.sidepanel{
  position:fixed; top:0; bottom:0; left:0; right:auto;
  width:min(420px,96%); max-width:420px;
  transform:translateX(-110%); transition:transform .2s ease;
  background:var(--glass-strong);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border-right:1px solid var(--stroke);
  z-index:50; display:flex; flex-direction:column;
  box-shadow: var(--shadow);
}
.sidepanel.open{transform:none}
.side-header{
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 14px; border-bottom:1px solid var(--stroke)
}
.side-tabs{
  display:flex; gap:6px; padding:8px 10px; border-bottom:1px solid var(--stroke)
}
.stab{
  background:transparent;
  border:1px solid transparent;
  color:var(--gold-300);
  padding:8px 10px; border-radius:999px; cursor:pointer;
}
.stab:hover{
  border-color: var(--stroke);
  background: rgba(0,0,0,0.12);
  color: var(--gold);
}
.stab.active{
  border-color: var(--gold);
  background: rgba(212,175,55,0.10);
  color:#fff;
}
.side-content{padding:12px; overflow:auto; height:100%}
.spanel{display:none}
.spanel.visible{display:block}

.history{display:flex; flex-direction:column; gap:8px; padding-left:18px}
.history li{background:var(--field-glass); border:1px solid rgba(255,255,255,.10); border-radius:10px; padding:8px}

/* мобильные переключатели */
.mobile-only{display:none}
.desktop-only{display:block}
body.mobile .mobile-only{display:block}
body.mobile .desktop-only{display:none}

.music-controls .btn{min-width:40px}
#nowPlaying{display:block}

/* === Музыка: переносы === */
#mode-music{ max-width:100%; overflow-x:hidden; }
#mode-music.mode.visible{ display:flex; flex-direction:column; gap:12px; }
#mode-music .row{ flex-wrap:wrap; }

/* На мобилках меньше blur для скорости */
@media (hover:none), (pointer:coarse){
  .app-header, .tabs, .sidepanel{
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
  }
}
/* === Формулы: читаемая «проза» и не вылезает за экран === */
.prose{
  background: rgba(11,18,32,0.22);
  border:1px solid rgba(255,255,255,.10);
  border-radius:12px;
  padding:14px;
  max-height:420px;
  overflow:auto;
}
.prose code{
  font-family: var(--mono);
  background: rgba(0,0,0,.35);
  padding: .1em .4em;
  border-radius:.35em;
  border:1px solid rgba(255,255,255,.08);
}
.nice-list{ margin:0; padding-left:18px; }
.nice-list li{ margin:.55em 0; line-height:1.55; }
/* фикс: вернуть нормальные галочки для выбора источников */
.sources-grid input[type=checkbox] {
  -webkit-appearance: checkbox !important;
  -moz-appearance: checkbox !important;
  appearance: checkbox !important;
  display: inline-block !important;
  width: 16px !important;
  height: 16px !important;
  margin: 0 6px 0 0 !important;
}
